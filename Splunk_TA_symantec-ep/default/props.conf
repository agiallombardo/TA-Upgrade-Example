##
## SPDX-FileCopyrightText: 2020 Splunk, Inc. <sales@splunk.com>
## SPDX-License-Identifier: LicenseRef-Splunk-1-2020
##
##
[source::...*ta_symantec-ep.log]
EVENT_BREAKER_ENABLE = true
sourcetype = ta_symantec-ep

[symantec:ep:syslog]
TRANSFORMS-sub_sourcetype_sep = force_sourcetype_sep_scm_system, force_sourcetype_sep_agent, force_sourcetype_sep_admin, force_sourcetype_sep_policy, force_sourcetype_sep_behavior, force_sourcetype_sep_scan, force_sourcetype_sep_security, force_sourcetype_sep_traffic, force_sourcetype_sep_packet, force_sourcetype_sep_agt_system, force_sourcetype_sep_risk, force_sourcetype_sep_proactive
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection via syslog
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true

[symantec:ep:agt_system:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection client agent system events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_agt_system = field_extraction_for_agt_system

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
LOOKUP-vendor_severity_to_severity = symantec_ep_severity_lookup vendor_severity OUTPUT severity
EVAL-vendor_product = "Symantec Endpoint Protection"

[symantec:ep:agt:system:syslog]
# Copied field extraction from symantec:ep:agt_system:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection client agent system events
REPORT-field_extraction_for_agt_system = field_extraction_for_agt_system

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
LOOKUP-vendor_severity_to_severity = symantec_ep_severity_lookup vendor_severity OUTPUT severity
EVAL-vendor_product = "Symantec Endpoint Protection"


[symantec:ep:scm_system:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server system events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_scm_system = field_extraction_for_scm_system

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
EVAL-vendor_product = "Symantec Endpoint Protection"

[symantec:ep:scm:system:syslog]
# Copied field extraction from symantec:ep:scm_system:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server system events
REPORT-field_extraction_for_scm_system = field_extraction_for_scm_system

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
EVAL-vendor_product = "Symantec Endpoint Protection"


[symantec:ep:agent:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server client agent events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_agent_act = field_extraction_for_agent_act

# Purpose for below "EVAL": trim ' or " from field value.
EVAL-user = nullif(trim(user, "\"'"), "")

######## For CIM Mapping ##########
FIELDALIAS-src = Host_Name as src
FIELDALIAS-src_user = user as src_user
FIELDALIAS-dest = Server_Name as dest
FIELDALIAS-dvc = Server_Name as dvc
FIELDALIAS-result = Event_Description as result
LOOKUP-vendor_action_for_agent_act = symantec_ep_admin_action_lookup vendor_action as Event_Description OUTPUT action, change_type
EVAL-vendor_product = "Symantec Endpoint Protection"

[symantec:ep:agent:syslog]
# Copied field extraction from symantec:ep:agent:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server client agent events
REPORT-field_extraction_for_agent_act = field_extraction_for_agent_act

# Purpose for below "EVAL": trim ' or " from field value.
EVAL-user = nullif(trim(user, "\"'"), "")

######## For CIM Mapping ##########
FIELDALIAS-src = Host_Name as src
FIELDALIAS-src_user = user as src_user
FIELDALIAS-dest = Server_Name as dest
FIELDALIAS-dvc = Server_Name as dvc
FIELDALIAS-result = Event_Description as result
LOOKUP-vendor_action_for_agent_act = symantec_ep_admin_action_lookup vendor_action as Event_Description OUTPUT action, change_type
EVAL-vendor_product = "Symantec Endpoint Protection"


[symantec:ep:behavior:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent behavior events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_agt_behavior = field_extraction_for_agt_behavior, process_from_caller_process_name, caller_md5_from_description, filename_from_caller_process_name
FIELDALIAS-vendor_action_SEP_behavior_vendor_action = vendor_action as SEP_behavior_vendor_action
FIELDALIAS-file_path = Caller_Process_Name as file_path

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# For the case: "Rule: Allow ping, pong and tracert"
EVAL-rule = nullif(trim(replace(rule, "[^:]+:\s*(.*)", "\1"), "\"'"), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "\'"), Description)), "Description:\s*", ""), "")

###### For CIM mapping #########
EVAL-vendor_product = "Symantec Endpoint Protection"
FIELDALIAS-Host_Name_dest = Host_Name as dest
LOOKUP-vendor_action_to_action = symantec_ep_action_lookup vendor_action as SEP_behavior_vendor_action OUTPUT action action as SEP_behavior_action
LOOKUP-vendor_severity_to_severity = symantec_ep_severity_lookup vendor_severity OUTPUT severity
FIELDALIAS-Domain_Name_dest_nt_domain = Domain_Name as dest_nt_domain

[symantec:ep:behavior:syslog]
# Copied field extraction from symantec:ep:behavior:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent behavior events
REPORT-field_extraction_for_agt_behavior = field_extraction_for_agt_behavior, process_from_caller_process_name, caller_md5_from_description, filename_from_caller_process_name
FIELDALIAS-vendor_action_SEP_behavior_vendor_action = vendor_action as SEP_behavior_vendor_action
FIELDALIAS-file_path = Caller_Process_Name as file_path

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# For the case: "Rule: Allow ping, pong and tracert"
EVAL-rule = nullif(trim(replace(rule, "[^:]+:\s*(.*)", "\1"), "\"'"), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "\'"), Description)), "Description:\s*", ""), "")

###### For CIM mapping #########
EVAL-vendor_product = "Symantec Endpoint Protection"
FIELDALIAS-Host_Name_dest = Host_Name as dest
LOOKUP-vendor_action_to_action = symantec_ep_action_lookup vendor_action as SEP_behavior_vendor_action OUTPUT action action as SEP_behavior_action
LOOKUP-vendor_severity_to_severity = symantec_ep_severity_lookup vendor_severity OUTPUT severity
FIELDALIAS-Domain_Name_dest_nt_domain = Domain_Name as dest_nt_domain


[symantec:ep:risk:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent risk events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_agt_risk = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_risk_action, field_extraction_file_path_description, field_extraction_agt_risk_reason_for_allowing, field_extraction_agt_risk_unknown_field
FIELDALIAS-0_rename_fields_from_agt_risk_report = "Actual action" as vendor_action "Application hash" as Application_Hash "Application name" as Application_Name "Application type" as Application_Type "Application version" as Application_Version "Category set" as Category_Set "Category type" as Category_Type "Certificate issuer" as Certificate_Issuer "Certificate serial number" as Certificate_Serial_Number "Certificate signer" as Certificate_Signer "Certificate thumbprint" as Certificate_Thumbprint "Company name" as Company_Name "Computer name" as Computer_Name "Download site" as Download_Site "Downloaded by" as Downloaded_By "Event time" as Event_Time "File size (bytes)" as File_Size "First Seen" as First_Seen "Hash type" as Hash_Type "IP Address" as IP_Address "Intensive Protection Level" as Intensive_Protection_Level "Last update time" as Last_Update_Time "Requested action" as Requested_Action "Risk name" as Risk_Name "Secondary action" as Secondary_Action "Signing timestamp" as Signing_Timestamp "URL Tracking Status" as URL_Tracking_Status "Web domain" as Web_Domain
FIELDALIAS-SEP_risk_signature = "Risk name" as SEP_risk_signature

EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-End_Time = coalesce('End','End Time')
EVAL-Event_Insert_Time = coalesce('Inserted','Event Insert Time')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Server_Name = coalesce('Server Name','Server')
EVAL-Source_Computer_Name = coalesce('Source computer','Source Computer Name')
EVAL-Source_Computer_IP = coalesce('Source IP','Source Computer IP')

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(coalesce('User', 'User Name'), "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# trim the quotation marks and key from value
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "\'"), Description)), "Description:\s*", ""), "")

# For the case "Field: null" set the field to be null.
EVAL-Web_Domain = if(Web_Domain=="" OR Web_Domain=="null", null, Web_Domain)
EVAL-Downloaded_By = if(Downloaded_By=="null" OR Downloaded_By=="", null, Downloaded_By)
EVAL-Download_Site = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-url = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)

# Removing the string "File path: from value of file_path
EVAL-file_path = nullif(replace(file_path, "File path:\s*", ""), "")

###### For CIM mapping #######
EVAL-date = nullif(replace(Event_Time, "\s*(\S+)\s.*", "\1"), "")
EVAL-file_name = nullif(replace(file_path, ".*[\\\|\/](.+)", "\1"), "")
FIELDALIAS-signature = "Risk name" as signature
FIELDALIAS-file_hash = "Application hash" as file_hash
FIELDALIAS-file_hash_type = "Hash type" as file_hash_type
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-src = coalesce('Source computer','Source Computer Name')
EVAL-src_ip = coalesce('Source IP','Source Computer IP')
FIELDALIAS-dest = "Computer name" as dest
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
FIELDALIAS-dest_ip = "IP Address" as dest_ip
LOOKUP-risk_vendor_action_to_action = symantec_ep_action_lookup vendor_action OUTPUT action

[symantec:ep:risk:syslog]
# Copied field extraction from symantec:ep:risk:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent risk events
REPORT-field_extraction_for_agt_risk = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_risk_action, field_extraction_file_path_description, field_extraction_agt_risk_reason_for_allowing, field_extraction_agt_risk_unknown_field
FIELDALIAS-0_rename_fields_from_agt_risk_report = "Actual action" as vendor_action "Application hash" as Application_Hash "Application name" as Application_Name "Application type" as Application_Type "Application version" as Application_Version "Category set" as Category_Set "Category type" as Category_Type "Certificate issuer" as Certificate_Issuer "Certificate serial number" as Certificate_Serial_Number "Certificate signer" as Certificate_Signer "Certificate thumbprint" as Certificate_Thumbprint "Company name" as Company_Name "Computer name" as Computer_Name "Download site" as Download_Site "Downloaded by" as Downloaded_By "Event time" as Event_Time "File size (bytes)" as File_Size "First Seen" as First_Seen "Hash type" as Hash_Type "IP Address" as IP_Address "Intensive Protection Level" as Intensive_Protection_Level "Last update time" as Last_Update_Time "Requested action" as Requested_Action "Risk name" as Risk_Name "Secondary action" as Secondary_Action "Signing timestamp" as Signing_Timestamp "URL Tracking Status" as URL_Tracking_Status "Web domain" as Web_Domain
FIELDALIAS-SEP_risk_signature = "Risk name" as SEP_risk_signature

EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-End_Time = coalesce('End','End Time')
EVAL-Event_Insert_Time = coalesce('Inserted','Event Insert Time')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Server_Name = coalesce('Server Name','Server')
EVAL-Source_Computer_Name = coalesce('Source computer','Source Computer Name')
EVAL-Source_Computer_IP = coalesce('Source IP','Source Computer IP')

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(coalesce('User', 'User Name'), "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# trim the quotation marks and key from value
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "\'"), Description)), "Description:\s*", ""), "")

# For the case "Field: null" set the field to be null.
EVAL-Web_Domain = if(Web_Domain=="" OR Web_Domain=="null", null, Web_Domain)
EVAL-Downloaded_By = if(Downloaded_By=="null" OR Downloaded_By=="", null, Downloaded_By)
EVAL-Download_Site = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-url = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)

# Removing the string "File path: from value of file_path
EVAL-file_path = nullif(replace(file_path, "File path:\s*", ""), "")

###### For CIM mapping #######
EVAL-date = nullif(replace(Event_Time, "\s*(\S+)\s.*", "\1"), "")
EVAL-file_name = nullif(replace(file_path, ".*[\\\|\/](.+)", "\1"), "")
FIELDALIAS-signature = "Risk name" as signature
FIELDALIAS-file_hash = "Application hash" as file_hash
FIELDALIAS-file_hash_type = "Hash type" as file_hash_type
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-src = coalesce('Source computer','Source Computer Name')
EVAL-src_ip = coalesce('Source IP','Source Computer IP')
FIELDALIAS-dest = "Computer name" as dest
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
FIELDALIAS-dest_ip = "IP Address" as dest_ip
LOOKUP-risk_vendor_action_to_action = symantec_ep_action_lookup vendor_action OUTPUT action


[symantec:ep:security:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent security events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_agt_security = field_extraction_for_agt_security_1, field_extraction_for_agt_security_2, category_from_description, filename_from_filepath
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-Intrusion_URL = trim(trim(Intrusion_URL,"\'"),"\"")

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
# Trim quotation marks
EVAL-category = nullif(trim(category, "\"'"), "")

##### For CIM mapping ######## 
FIELDALIAS-dvc = Host_Name as dvc
EVAL-direction = lower(Traffic_Direction)
EVAL-dest = if(Traffic_Direction=="Inbound", Local_Host_IP, Remote_Host_IP)
EVAL-src = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
EVAL-vendor_product = "Symantec Endpoint Protection"
FIELDALIAS-signature = CIDS_Signature_String as signature
EVAL-ids_type = "host"
EVAL-action = case(match(Event_Description, "[nN]ot(\s+\w*)?\s[bB]lock"), "allowed", match(Event_Description, "[bB]lock"), "blocked", match(Event_Description, "[nN]ot(\s+\w*)?\s[aA]llow"), "blocked", 1==1, "allowed")
EVAL-dest_ip = if(Traffic_Direction=="Inbound", Local_Host_IP, Remote_Host_IP)
EVAL-src_ip = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
LOOKUP-vendor_severity_to_severity = symantec_ep_severity_lookup vendor_severity OUTPUT severity

[symantec:ep:security:syslog]
# Copied field extraction from symantec:ep:security:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent security events
REPORT-field_extraction_for_agt_security = field_extraction_for_agt_security_1, field_extraction_for_agt_security_2, category_from_description, filename_from_filepath
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-Intrusion_URL = trim(trim(Intrusion_URL,"\'"),"\"")

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")
# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")
# Trim quotation marks
EVAL-category = nullif(trim(category, "\"'"), "")

##### For CIM mapping ######## 
FIELDALIAS-dvc = Host_Name as dvc
EVAL-direction = lower(Traffic_Direction)
EVAL-dest = if(Traffic_Direction=="Inbound", Local_Host_IP, Remote_Host_IP)
EVAL-src = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
EVAL-vendor_product = "Symantec Endpoint Protection"
FIELDALIAS-signature = CIDS_Signature_String as signature
EVAL-ids_type = "host"
EVAL-action = case(match(Event_Description, "[nN]ot(\s+\w*)?\s[bB]lock"), "allowed", match(Event_Description, "[bB]lock"), "blocked", match(Event_Description, "[nN]ot(\s+\w*)?\s[aA]llow"), "blocked", 1==1, "allowed")
EVAL-dest_ip = if(Traffic_Direction=="Inbound", Local_Host_IP, Remote_Host_IP)
EVAL-src_ip = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)
LOOKUP-vendor_severity_to_severity = symantec_ep_severity_lookup vendor_severity OUTPUT severity


[symantec:ep:scan:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent scan events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_agt_scan = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_status, field_extraction_start_message_stop_message
FIELDALIAS-0_rename_fields_from_agt_scan_file_report = "Scan ID" as Scan_ID "Duration (seconds)" as Duration "User1" as Client_User_1 "User2" as Client_User_2 "Infected" as Infected_Files "Omitted" as Omitted_Files "IP Address" as IP_Address 
EVAL-Begin_Time = coalesce('Begin','Begin Time')
EVAL-End_Time = coalesce('End','End Time')
EVAL-Computer_Name = coalesce('Computer','Computer Name')
EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Server_Name = coalesce('Server','Server Name')
FIELDALIAS-SEP_Scan_Infected_Files = "Infected" as SEP_Scan_Infected_Files
EVAL-Start_Message = nullif(trim(Start_Message, "\"'"), "")
EVAL-Stop_Message = nullif(trim(Stop_Message, "\"'"), "")

# For the case: "Totalfiles"
EVAL-Total_Files = coalesce('Total files','Totalfiles')

##### For CIM mapping ######
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-dest = coalesce('Computer','Computer Name')
FIELDALIAS-dest_ip = "IP Address" as dest_ip
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
EVAL-user = if(isnull(User2), User1, User2)

[symantec:ep:scan:syslog]
# Copied field extraction from symantec:ep:scan:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent scan events
REPORT-field_extraction_for_agt_scan = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_status, field_extraction_start_message_stop_message
FIELDALIAS-0_rename_fields_from_agt_scan_file_report = "Scan ID" as Scan_ID "Duration (seconds)" as Duration "User1" as Client_User_1 "User2" as Client_User_2 "Infected" as Infected_Files "Omitted" as Omitted_Files "IP Address" as IP_Address 
EVAL-Begin_Time = coalesce('Begin','Begin Time')
EVAL-End_Time = coalesce('End','End Time')
EVAL-Computer_Name = coalesce('Computer','Computer Name')
EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Server_Name = coalesce('Server','Server Name')
FIELDALIAS-SEP_Scan_Infected_Files = "Infected" as SEP_Scan_Infected_Files
EVAL-Start_Message = nullif(trim(Start_Message, "\"'"), "")
EVAL-Stop_Message = nullif(trim(Stop_Message, "\"'"), "")

# For the case: "Totalfiles"
EVAL-Total_Files = coalesce('Total files','Totalfiles')

##### For CIM mapping ######
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-dest = coalesce('Computer','Computer Name')
FIELDALIAS-dest_ip = "IP Address" as dest_ip
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
EVAL-user = if(isnull(User2), User1, User2)


[symantec:ep:proactive:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent proactive events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_agt_proactive = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_risk_action, field_extraction_file_path_description, field_extraction_proactive_submission_recommendation
FIELDALIAS-0_rename_fields_from_proactive_file_report = "Computer name" as Computer_Name "IP Address" as IP_Address "Detection type" as Detection_Type "First Seen" as First_Seen  "Application name" as Application_Name "Application type" as Application_Type "Application version" as Application_Version "Hash type" as Hash_Type "Application hash" as Application_Hash "Company name" as Company_Name "File size (bytes)" as File_Size "Detection score" as Detection_Score "COH Engine Version" as COH_Engine_Version "Permitted application reason" as Permitted_Application_Reason "Download site" as Download_Site "Web domain" as Web_Domain "Downloaded by" as Downloaded_By "URL Tracking Status" as URL_Tracking_Status "Risk Level" as Risk_Level "Risk type" as Risk_Type "Detection Source" as Detection_Source "Risk name" as Risk_Name "Actual action" as vendor_action "Requested action" as Requested_Action "Secondary action" as Secondary_Action "Event time" as Event_Time "Inserted" as Event_Insert_Time "End" as End_Time "Intensive Protection Level" as Intensive_Protection_Level "Certificate issuer" as Certificate_Issuer "Certificate signer" as Certificate_Signer "Certificate thumbprint" as Certificate_Thumbprint "Signing timestamp" as Signing_Timestamp "Certificate serial number" as Certificate_Serial_Number

EVAL-Source_Computer_Name = coalesce('Source computer','Source Computer Name')
EVAL-Source_Computer_IP = coalesce('Source IP','Source Computer IP')
EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-Server_Name = coalesce('Server','Server Name')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Detection_Source = if(Detection_Source=="" OR Detection_Source=="N/A", null, Detection_Source)
EVAL-Web_Domain = if(Web_Domain=="" OR Web_Domain=="null", null, Web_Domain)
EVAL-Downloaded_By = if(Downloaded_By=="null" OR Downloaded_By=="", null, Downloaded_By)
EVAL-Download_Site = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-url = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
FIELDALIAS-category = "Detection type" as category

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "^\'"), Description)), "Description:\s*", ""), "")
# trim the quotation marks
EVAL-Application_Version = nullif(trim(Application_Version, "\"'"), "")

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(coalesce('User','User Name'), "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

##### For CIM mapping #######
EVAL-date = nullif(replace(Event_Time, "\s*(\S+)\s.*", "\1"), "")
EVAL-file_name = nullif(replace(file_path, ".*[\\\|\/](.+)", "\1"), "")
FIELDALIAS-signature = "Application type" as signature
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-src = coalesce('Source computer','Source Computer Name')
EVAL-src_ip = coalesce('Source IP','Source Computer IP')
FIELDALIAS-dest = "Computer name" as dest
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
FIELDALIAS-file_hash = "Application hash" as file_hash
FIELDALIAS-file_hash_type = "Hash type" as file_hash_type
LOOKUP-proactive_vendor_action_to_action = symantec_ep_action_lookup vendor_action OUTPUT action

[symantec:ep:proactive:syslog]
# Copied field extraction from symantec:ep:proactive:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent proactive events
REPORT-field_extraction_for_agt_proactive = field_extraction_key_value_pairs_1, field_extraction_key_value_pairs_2, field_extraction_key_value_pairs_3, field_extraction_key_value_pairs_4, field_extraction_key_value_pairs_5, field_extraction_risk_action, field_extraction_file_path_description, field_extraction_proactive_submission_recommendation
FIELDALIAS-0_rename_fields_from_proactive_file_report = "Computer name" as Computer_Name "IP Address" as IP_Address "Detection type" as Detection_Type "First Seen" as First_Seen  "Application name" as Application_Name "Application type" as Application_Type "Application version" as Application_Version "Hash type" as Hash_Type "Application hash" as Application_Hash "Company name" as Company_Name "File size (bytes)" as File_Size "Detection score" as Detection_Score "COH Engine Version" as COH_Engine_Version "Permitted application reason" as Permitted_Application_Reason "Download site" as Download_Site "Web domain" as Web_Domain "Downloaded by" as Downloaded_By "URL Tracking Status" as URL_Tracking_Status "Risk Level" as Risk_Level "Risk type" as Risk_Type "Detection Source" as Detection_Source "Risk name" as Risk_Name "Actual action" as vendor_action "Requested action" as Requested_Action "Secondary action" as Secondary_Action "Event time" as Event_Time "Inserted" as Event_Insert_Time "End" as End_Time "Intensive Protection Level" as Intensive_Protection_Level "Certificate issuer" as Certificate_Issuer "Certificate signer" as Certificate_Signer "Certificate thumbprint" as Certificate_Thumbprint "Signing timestamp" as Signing_Timestamp "Certificate serial number" as Certificate_Serial_Number

EVAL-Source_Computer_Name = coalesce('Source computer','Source Computer Name')
EVAL-Source_Computer_IP = coalesce('Source IP','Source Computer IP')
EVAL-Domain_Name = coalesce('Domain','Domain Name')
EVAL-Server_Name = coalesce('Server','Server Name')
EVAL-Group_Name = coalesce('Group','Group Name')
EVAL-Detection_Source = if(Detection_Source=="" OR Detection_Source=="N/A", null, Detection_Source)
EVAL-Web_Domain = if(Web_Domain=="" OR Web_Domain=="null", null, Web_Domain)
EVAL-Downloaded_By = if(Downloaded_By=="null" OR Downloaded_By=="", null, Downloaded_By)
EVAL-Download_Site = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
EVAL-url = if(Download_Site=="null" OR Download_Site=="", null, Download_Site)
FIELDALIAS-category = "Detection type" as category

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Description = nullif(replace(if(match(Description, "^\".*"), trim(Description, "\""), if(match(Description, "^\'.*"), trim(Description, "^\'"), Description)), "Description:\s*", ""), "")
# trim the quotation marks
EVAL-Application_Version = nullif(trim(Application_Version, "\"'"), "")

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(coalesce('User','User Name'), "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

##### For CIM mapping #######
EVAL-date = nullif(replace(Event_Time, "\s*(\S+)\s.*", "\1"), "")
EVAL-file_name = nullif(replace(file_path, ".*[\\\|\/](.+)", "\1"), "")
FIELDALIAS-signature = "Application type" as signature
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-src = coalesce('Source computer','Source Computer Name')
EVAL-src_ip = coalesce('Source IP','Source Computer IP')
FIELDALIAS-dest = "Computer name" as dest
EVAL-dest_nt_domain = coalesce('Domain','Domain Name')
FIELDALIAS-file_hash = "Application hash" as file_hash
FIELDALIAS-file_hash_type = "Hash type" as file_hash_type
LOOKUP-proactive_vendor_action_to_action = symantec_ep_action_lookup vendor_action OUTPUT action


[symantec:ep:admin:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server admin events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_admin = field_extraction_for_admin


##### For CIM mapping ######
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-app = "Symantec"
FIELDALIAS-user = "Admin_Name" as user
FIELDALIAS-dest = "Server_Name" as dest
LOOKUP-Event_Description_to_action = symantec_ep_admin_authentication_action_lookup Event_Description OUTPUT action

[symantec:ep:admin:syslog]
# Copied field extraction from symantec:ep:admin:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server admin events
REPORT-field_extraction_for_admin = field_extraction_for_admin


##### For CIM mapping ######
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-app = "Symantec"
FIELDALIAS-user = "Admin_Name" as user
FIELDALIAS-dest = "Server_Name" as dest
LOOKUP-Event_Description_to_action = symantec_ep_admin_authentication_action_lookup Event_Description OUTPUT action

[symantec:ep:policy:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server policy events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_policy = field_extraction_for_policy
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-Policy_Name = nullif(trim(Policy_Name, "\"'"), "")

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")

[symantec:ep:policy:syslog]
# Copied field extraction from symantec:ep:policy:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection server policy events
REPORT-field_extraction_for_policy = field_extraction_for_policy
EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-Policy_Name = nullif(trim(Policy_Name, "\"'"), "")

# Purpose for below "EVAL": trim ' or " or key from field value.
EVAL-Event_Description = nullif(replace(if(match(Event_Description, "^\".*"), trim(Event_Description, "\""), if(match(Event_Description, "^\'.*"), trim(Event_Description, "\'"), Event_Description)), "Event Description:\s*", ""), "")


[symantec:ep:packet:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection client packet events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_packet = field_extraction_for_packet
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-vendor_product = "Symantec Endpoint Protection"

[symantec:ep:packet:syslog]
# Copied field extraction from symantec:ep:packet:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection client packet events
REPORT-field_extraction_for_packet = field_extraction_for_packet
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
EVAL-vendor_product = "Symantec Endpoint Protection"


[symantec:ep:traffic:file]
TRANSFORMS-nullqueueheader = sep_file_header
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent traffic events
MAX_TIMESTAMP_LOOKAHEAD = 32
SHOULD_LINEMERGE = false
EVENT_BREAKER_ENABLE = true
REPORT-field_extraction_for_traffic = field_extraction_for_agt_traffic_1, field_extraction_for_agt_traffic_2, filename_from_filepath
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
FIELDALIAS-SEP_Traffic_Direction = Traffic_Direction as SEP_Traffic_Direction
FIELDALIAS-SEP_traffic_vendor_action = vendor_action as SEP_traffic_vendor_action
FIELDALIAS-file_path = Application_Name as file_path

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# For the case: "Rule: Allow ping, pong and tracert"
EVAL-rule = nullif(trim(replace(rule, "[^:]+:\s*(.*)", "\1"), "\"'"), "")

##### For CIM mapping #######
####### fields for both 'Network Traffic' and IDS model #####
FIELDALIAS-dvc_from_host_for_sep = Host_Name as dvc
LOOKUP-symantec_ep_vendor_action_lookup_for_traffic_file = symantec_ep_action_lookup vendor_action as SEP_traffic_vendor_action OUTPUT action action as SEP_traffic_action

######## fields for 'Network Traffic' model ##########
EVAL-direction = lower(Traffic_Direction)
EVAL-dest_ip = if(Traffic_Direction=="Inbound", Local_Host_IP, Remote_Host_IP)
EVAL-src_ip = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)

EVAL-dest = if(Traffic_Direction=="Inbound", if(Host_Name=="" OR isnull(Host_Name), Local_Host_IP, trim(trim(Host_Name,"\'"),"\"")), if(Remote_Host_Name=="" OR isnull(Remote_Host_Name), Remote_Host_IP, Remote_Host_Name))
EVAL-src = if(Traffic_Direction=="Outbound", if(Host_Name=="" OR isnull(Host_Name), Local_Host_IP, trim(trim(Host_Name,"\'"),"\"")), if(Remote_Host_Name=="" OR isnull(Remote_Host_Name), Remote_Host_IP, Remote_Host_Name))

EVAL-dest_port = if(Traffic_Direction=="Inbound", Local_Port, Remote_Port)
EVAL-src_port = if(Traffic_Direction=="Outbound", Local_Port, Remote_Port)

EVAL-dest_mac = if(Traffic_Direction=="Outbound", lower(replace(Remote_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")), lower(replace(Local_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")))
EVAL-src_mac = if(Traffic_Direction=="Inbound", lower(replace(Remote_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")), lower(replace(Local_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")))

EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-protocol = if(Network_Protocol=="ICMP" OR isint(Network_Protocol), "icmp", "ip")
EVAL-icmp_type_code = if(isint(Network_Protocol), Network_Protocol, null)
LOOKUP-symantec_ep_icmp_type = symantec_ep_icmp_type_lookup icmp_type_code OUTPUT icmp_type_name
EVAL-transport = if(Network_Protocol=="TCP", "tcp", if(Network_Protocol=="UDP", "udp", "unknown"))
EVAL-duration = strptime(End_Time, "%Y-%m-%d %H:%M:%S")-strptime(Begin_Time, "%Y-%m-%d %H:%M:%S")

##### fields for IDS model (The inbound blocked events is mapped to IDS) #####
EVAL-category =  if(Traffic_Direction=="Inbound" AND match(vendor_action, "[Bb]lock"), "traffic", null)
EVAL-ids_type = if(Traffic_Direction=="Inbound" AND match(vendor_action, "[Bb]lock"), "host", null)
LOOKUP-symantec_ep_severity_lookup_for_traffic_file = symantec_ep_severity_lookup vendor_severity OUTPUT severity
EVAL-signature = if(Traffic_Direction=="Inbound" AND match(vendor_action, "[Bb]lock"), nullif(replace(rule, "[^:]+:\s*(.*)", "\1"), ""), null)

[symantec:ep:traffic:syslog]
# Copied field extraction from symantec:ep:traffic:file sourcetype
KV_MODE = none
pulldown_type = true
category = Network & Security
description = Symantec Endpoint Protection agent traffic events
REPORT-field_extraction_for_traffic = field_extraction_for_agt_traffic_1, field_extraction_for_agt_traffic_2, filename_from_filepath
EVAL-Host_Name = trim(trim(Host_Name,"\'"),"\"")
FIELDALIAS-SEP_Traffic_Direction = Traffic_Direction as SEP_Traffic_Direction
FIELDALIAS-SEP_traffic_vendor_action = vendor_action as SEP_traffic_vendor_action
FIELDALIAS-file_path = Application_Name as file_path

# For the case: "User Name: user1,user2"
EVAL-user = nullif(split(trim(replace(user, "[^:]+:\s*(.*)", "\1"), "\"'"), ","), "")

# For the case: "Rule: Allow ping, pong and tracert"
EVAL-rule = nullif(trim(replace(rule, "[^:]+:\s*(.*)", "\1"), "\"'"), "")

##### For CIM mapping #######
####### fields for both 'Network Traffic' and IDS model #####
FIELDALIAS-dvc_from_host_for_sep = Host_Name as dvc
LOOKUP-symantec_ep_vendor_action_lookup_for_traffic_file = symantec_ep_action_lookup vendor_action as SEP_traffic_vendor_action OUTPUT action action as SEP_traffic_action

######## fields for 'Network Traffic' model ##########
EVAL-direction = lower(Traffic_Direction)
EVAL-dest_ip = if(Traffic_Direction=="Inbound", Local_Host_IP, Remote_Host_IP)
EVAL-src_ip = if(Traffic_Direction=="Outbound", Local_Host_IP, Remote_Host_IP)

EVAL-dest = if(Traffic_Direction=="Inbound", if(Host_Name=="" OR isnull(Host_Name), Local_Host_IP, trim(trim(Host_Name,"\'"),"\"")), if(Remote_Host_Name=="" OR isnull(Remote_Host_Name), Remote_Host_IP, Remote_Host_Name))
EVAL-src = if(Traffic_Direction=="Outbound", if(Host_Name=="" OR isnull(Host_Name), Local_Host_IP, trim(trim(Host_Name,"\'"),"\"")), if(Remote_Host_Name=="" OR isnull(Remote_Host_Name), Remote_Host_IP, Remote_Host_Name))

EVAL-dest_port = if(Traffic_Direction=="Inbound", Local_Port, Remote_Port)
EVAL-src_port = if(Traffic_Direction=="Outbound", Local_Port, Remote_Port)

EVAL-dest_mac = if(Traffic_Direction=="Outbound", lower(replace(Remote_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")), lower(replace(Local_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")))
EVAL-src_mac = if(Traffic_Direction=="Inbound", lower(replace(Remote_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")), lower(replace(Local_Host_MAC, "(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})(\w{2})", "\1:\2:\3:\4:\5:\6")))

EVAL-vendor_product = "Symantec Endpoint Protection"
EVAL-protocol = if(Network_Protocol=="ICMP" OR isint(Network_Protocol), "icmp", "ip")
EVAL-icmp_type_code = if(isint(Network_Protocol), Network_Protocol, null)
LOOKUP-symantec_ep_icmp_type = symantec_ep_icmp_type_lookup icmp_type_code OUTPUT icmp_type_name
EVAL-transport = if(Network_Protocol=="TCP", "tcp", if(Network_Protocol=="UDP", "udp", "unknown"))
EVAL-duration = strptime(End_Time, "%Y-%m-%d %H:%M:%S")-strptime(Begin_Time, "%Y-%m-%d %H:%M:%S")

##### fields for IDS model (The inbound blocked events is mapped to IDS) #####
EVAL-category =  if(Traffic_Direction=="Inbound" AND match(vendor_action, "[Bb]lock"), "traffic", null)
EVAL-ids_type = if(Traffic_Direction=="Inbound" AND match(vendor_action, "[Bb]lock"), "host", null)
LOOKUP-symantec_ep_severity_lookup_for_traffic_file = symantec_ep_severity_lookup vendor_severity OUTPUT severity
EVAL-signature = if(Traffic_Direction=="Inbound" AND match(vendor_action, "[Bb]lock"), nullif(replace(rule, "[^:]+:\s*(.*)", "\1"), ""), null)
